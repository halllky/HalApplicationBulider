# Nijo framework 【開発中 under development】
論理データモデルから一般的なエンタープライズ系業務アプリケーションのひな形を自動生成するツール。

---
目次 Table of contents

- [Nijo framework 【開発中 under development】](#nijo-framework-開発中-under-development)
  - [概要図 Overview](#概要図-overview)
  - [使い方の詳細 Usage](#使い方の詳細-usage)
    - [1. 論理データモデルを定義する](#1-論理データモデルを定義する)
    - [2. コード自動生成を実行する](#2-コード自動生成を実行する)
    - [3. 自動生成で賄えない機能を自前で実装する](#3-自動生成で賄えない機能を自前で実装する)
    - [その他](#その他)
      - [nijo.exe のその他の使い方](#nijoexe-のその他の使い方)
  - [デモ Demo](#デモ-demo)
  - [このソフトウェアを作成した動機 Motivation](#このソフトウェアを作成した動機-motivation)
  - [License](#license)

---

## 概要図 Overview
このツールを使用してアプリケーションを作成するための大まかな流れは以下です。

1. [論理データモデルを定義する](#1-論理データモデルを定義する)
2. [コード自動生成を実行する](#2-コード自動生成を実行する)
3. [自動生成で賄えない機能を自前で実装する](#3-自動生成で賄えない機能を自前で実装する)

![概要図 overview](./README_files/README.drawio.svg)

## 使い方の詳細 Usage

### 1. 論理データモデルを定義する

このリポジトリのReleasesページから実行可能なバイナリファイルをダウンロードしてください。

---
ターミナルやコマンドプロンプトから以下を実行してください。MyProjectの名称は自由に設定してください。

```sh
nijo create MyProject
```

注意点
- 上記のコマンドは内部で `dotnet` および `npm` のコマンドラインツールを使用しています。それぞれMicrosoftおよびNode.jsの公式サイトから入手し、パスを通して使える状態にしてください。
- 上記のコマンドは `npm ci` を実行し、依存するパッケージのダウンロードを行います。ネットワークに接続された環境で実行してください。

---

作成されたディレクトリの中に `nijo.xml` という名前のファイルがあります。これをテキストエディタで編集し、あなたのアプリケーションで取り扱うデータの構造を定義してください。
詳細な属性の指定方法は [自動テストのXML](./Nijo.IntegrationTest/DataPatterns/) を参照してください。


### 2. コード自動生成を実行する
執筆中

### 3. 自動生成で賄えない機能を自前で実装する
執筆中

### その他
#### nijo.exe のその他の使い方
執筆中

## デモ Demo
- このリポジトリをクローンしてください。
- ユニットテストプロジェクト `Nijo.IntegrationTest` で様々なパターンのデータ構造定義をテストしています。「コンパイルエラーチェック」という名前のテストがあるので、閲覧したいデータ構造定義のテストを実行し、生成されたプロジェクトで実物の動作を確認してください。
  - どのようなパターンがあるかは [こちら](./Nijo.IntegrationTest/DataPatterns/) を参照してください。
  - ユニットテストの実行方法はNUnitの通常の実行方法に従ってください。
    1. Visual Studio のテストエクスプローラーから実行する（開発者はこちらの方法で実行しています）
    2. `dotnet test --filter "コンパイルエラーチェック(000_単純な集約.xml)"` のようにコマンドラインから実行する
- 上記テストの実行に成功した場合、 `/自動テストで作成されたプロジェクト` ディレクトリにプロジェクトが生成されます。
- プロジェクトのルートディレクトリ（ `nijo.xml` があるディレクトリ）でターミナルやコマンドプロンプトを開き、以下のコマンドを実行してください。

```sh
nijo debug
```

確認方法
- 作成されたWebサイトの動作確認
  - localhostで実行されます。自動的にブラウザが表示されますが、ポートなどの詳細は以下を参照してください。
  - クライアントサイド（React SPA）のポート等は `/自動テストで作成されたプロジェクト/react/vite.config.ts` で指定されています。詳細な設定方法はViteの公式を参照してください。
  - サーバーサイド（ASP.NET Core Web API）のポート等は `/自動テストで作成されたプロジェクト/webapi/Properties/launchSettings.json` で指定されています。
  - サーバーサイドのAPIはクライアントサイドから呼ばれる形で実行されるため通常意識する必要はありませんが、これを直接実行したい場合、実行中のlocalhostでswaggerが展開されているので、そちらを参照してください。
- DB定義やデータの確認
  - このWebサイトで登録されたデータは、プロジェクトのルートディレクトリにある、拡張子が `sqlite3` のファイルに格納されています。このファイルの開き方はSQLiteの公式を参照してください。
- 自動生成されたソースコードの内容の確認
  - サーバーサイドの自動生成ソースは `/自動テストで作成されたプロジェクト/webapi/__AutoGenerated/` に展開されます。
  - クライアントサイドの自動生成ソースは `/自動テストで作成されたプロジェクト/react/src/__autoGenerated/` に展開されます。


## このソフトウェアを作成した動機 Motivation
- 画面からDBまでを一気通貫でカバーしてくれるちょうどよいライブラリ・フレームワークが欲しかった。
- CRUD機能のうちCUDは自動生成する効果が大きいと感じていた。
  - データの形が違うだけで気を付けなければいけないポイントはだいたいいつも同じ（キー重複の考慮、同時編集や排他制御、更新データ中に配列がある場合の実装の大変さ、二重登録の考慮、トランザクションの切り方、など）
  - その割には品質が低い場合のシステム全体に及ぼす実害が参照系処理に比べてとても大きい
  - システムの主要なデータではない補助的なデータ（いわゆるトランザクションデータに対するマスタデータのこと）について、機能要件が緩くなりがち（登録更新さえできればUIは割とどうでもいい）な割に上記の通り実装が大変なので、ここが自動生成されるととても助かる
- データモデル駆動の要件定義のため。
  - ウォーターフォール開発の要件定義フェーズにおいて、チーム内でデータモデルの議論を軸にして検討を進めたいことがよくある。そこではメンバー間で実際に動くデータを見つつ認識共有しながら進まないと議論が空中戦になるのだが、そのためにはデータモデルのたたき台を考えてから実際に動くデータができるまでを数分程度で実現できるツールが必要だった。
- 上記のような要件を満たしつつ、通常のスクラッチ開発と同レベルの柔軟性をもったツールが欲しかった
  - ネストされた子要素、伝票の明細など子要素の配列、多態性をもった子要素、他のデータへの参照、といった複雑なデータ構造を定義できてほしい
  - 複雑なデータについてパフォーマンスを落とさず高速なクエリを発行するためにはCQRSや生SQLの実装ができるようになっていてほしい
  - 日次業務のオペレーションに耐えうる画面、現行の業務フローに合致した画面、など厳しい要件を満たすためには画面のソースをゼロから組み上げられるようになっていてほしい
- オンプレにしようと思えばオンプレにもできるアーキテクチャ
  - いわゆるエンタープライズ系システム・基幹寄りのシステムは、寿命が長いのでフルマネージドであっておきたい
  - クラウド型のSaaSは提供事業者の意思次第でいつでも使えなくなりうる

## License
This software is released under the MIT License. see LICENSE.txt.
