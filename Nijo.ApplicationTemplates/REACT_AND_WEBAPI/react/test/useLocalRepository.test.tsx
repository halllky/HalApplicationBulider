import { renderHook, act } from '@testing-library/react'
import { describe, expect, it } from "vitest"
import { LocalRepositoryArgs, useLocalRepository } from '../src/__autoGenerated/util/useBatchUpdate'
import { setup } from 'vitest-indexeddb'

describe('useLocalRepository状態遷移テスト', async () => {
  it('aaaaa', async () => {
    setup()
    const { result } = renderHook(() => useLocalRepository(REPOS_SETTING))

    // TOOD: 初期化待ちの方法が力業
    await new Promise<void>(resolve => setTimeout(() => resolve(), 1000))

    const items = await result.current.loadAll()
    expect(items.length).toBe(0)
  })

  type TestData = {
    key?: string
    name?: string
    numValue?: number
  }
  const REPOS_SETTING: LocalRepositoryArgs<TestData> = {
    dataTypeKey: 'TEST-DATA-20240204',
    serialize: data => JSON.stringify(data),
    deserialize: str => JSON.parse(str),
    getItemKey: data => data.key ?? '',
    getItemName: data => data.name ?? '',
  }
})
