import React from "react"
import "../__autoGenerated/nijo-default-style.css"

/**
 * 【パターン】
 * Container
 * - depth: 0, 1以上
 * - label: あり、なし
 * - leftColumnWidth: 指定あり、なし
 * - indentSizePx: 指定あり、なし
 *
 * Item
 * - label: あり、なし
 * - wide: true, false
 * - 位置: Containerの下、裸
 */


export default function () {

  return (
    <div
      className="flex flex-col gap-4 my-4 mx-auto max-w-[720px]
        border border-1 border-amber-500 p-1"
      style={{ fontFamily: 'BIZ UDGothic' }}>

      <VForm.Container label="メイン" indentSizePx={32} rightColumnWidth="28rem">
        <VForm.Item label="入力フォーム">
          <input type="text" className="border border-color-4" />
        </VForm.Item>
        <VForm.Item label="入力フォーム">
          <input type="text" className="border border-color-4" />
        </VForm.Item>
        <VForm.Container label="コンテナ2-1個目">
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
          <VForm.Container label="コンテナ2-1-1個目">
            <VForm.Item label="入力フォーム">
              <input type="text" className="border border-color-4" />
            </VForm.Item>
            <VForm.Item label="入力フォーム">
              {/* <input type="text" className="border border-color-4" /> */}
            </VForm.Item>
          </VForm.Container>
          <VForm.Item>
            <input type="text" className="border border-color-4" />
          </VForm.Item>
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
          <VForm.Container label="コンテナ2-1-2個目" labelSide={<AlertButton count={12} />}>
            <VForm.Item
              label="入力フォーム"
              labelSide={<>
                <span className="text-sm">※この項目の説明文。<br />この項目の理由、目的、背景など</span>
                <AlertButton count={2} />
              </>}
            >
              <input type="text" className="border border-color-4" />
            </VForm.Item>
            <VForm.Item label="入力フォームWIDE" labelSide={<AlertButton count={12} />} wide>
              <input type="text" className="border border-color-4" />
            </VForm.Item>
            <VForm.Item label="入力フォームWIDE" wide>
              <input type="text" className="border border-color-4 w-full" />
            </VForm.Item>
          </VForm.Container>
        </VForm.Container>

        <VForm.Container label="コンテナ2-2個目">
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
        </VForm.Container>

        <VForm.Container labelSide={<AlertButton />}>
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
          <VForm.Item label="入力フォーム">
            <input type="text" className="border border-color-4" />
          </VForm.Item>
        </VForm.Container>
      </VForm.Container>

      <VForm.Container>
        <VForm.Item label="Itemのみ">
          <input type="text" className="border border-color-4" />
        </VForm.Item>
        <VForm.Item label="Itemのみ">
          <input type="text" className="border border-color-4" />
        </VForm.Item>
      </VForm.Container>

      <VForm.Container label="Containerのみ" rightColumnWidth="24rem">
        <VForm.Container label="inner1">
          <VForm.Container label="inner2">
            <VForm.Container label="inner3">
              <VForm.Item label="入力フォーム">
                <input type="text" className="border border-color-4" />
              </VForm.Item>
              <VForm.Item label="入力フォーム">
                <input type="text" className="border border-color-4" />
              </VForm.Item>
            </VForm.Container>
          </VForm.Container>
        </VForm.Container>
      </VForm.Container>
    </div>
  )
}

const AlertButton = ({ count }: { count?: number }) => {
  return <>
    {Array.from({ length: count ?? 1 }).map((_, i) => (
      <input key={i} type="button" value="ボタン" onClick={() => alert('aaa')} className="border border-color-9 cursor-pointer" />
    ))}
  </>
}

// ----------------------------------------------------
/** 0個以上のItemまたはContainerを内部に含む入れ物。Containerに内包された要素はインデントが1段下がる。 */
const Container = ({
  label,
  labelSide,
  rightColumnWidth: propsRightColWidth,
  indentSizePx: propsIndentSizePx,
  children,
  className,
}: {
  label?: string
  labelSide?: React.ReactNode
  rightColumnWidth?: string
  indentSizePx?: number
  children?: React.ReactNode
  className?: string
}) => {
  const { depth, indentSizePx, rightColumnWidth } = React.useContext(VFormContext)
  const innerContextValue = React.useMemo<VFormContextValue>(() => ({
    depth: depth + 1,
    rightColumnWidth: propsRightColWidth ?? rightColumnWidth,
    indentSizePx: propsIndentSizePx ?? indentSizePx,
  }), [depth, propsRightColWidth, rightColumnWidth, propsIndentSizePx, indentSizePx])

  const isRoot = depth === 0

  return (
    <VFormContext.Provider value={innerContextValue}>
      <div className={`flex flex-col justify-start items-stretch ${className} ${!isRoot ? 'border-t first:border-none border-color-5' : ''}`}>
        {(label || labelSide) && (
          <div className={`flex flex-wrap gap-2 items-center ${isRoot ? 'py-1' : 'p-1'}`}>
            <LabelText>{label}</LabelText>
            {labelSide}
          </div>)}
        <div className="flex-1 flex bg-color-3">
          {!isRoot && <Indent className="bg-color-3" />}
          <div className={`flex-1 border-t border-l ${isRoot ? 'border-r border-b' : ''} border-color-5`}>
            {children}
          </div>
        </div>
      </div>
    </VFormContext.Provider>
  )
}

/** 名前と値のペア */
const Item = ({ label, labelSide, wide, children }: {
  label?: string
  labelSide?: React.ReactNode
  wide?: boolean
  children?: React.ReactNode
}) => {
  const { rightColumnWidth } = React.useContext(VFormContext)
  const valueColumnStyle: React.CSSProperties = {
    flex: wide ? '1' : undefined,
    flexBasis: wide ? undefined : (rightColumnWidth ?? '28rem'),
  }

  return <>
    {wide && label && (
      <div className="flex flex-wrap items-center gap-2 p-1 border-t first:border-none border-color-5">
        <LabelText>{label}</LabelText>
        {labelSide}
      </div >
    )}
    <div className="flex align-center border-t first:border-none border-color-5">
      {!wide && (
        <div className="flex-1 flex flex-col items-start gap-2 p-1 bg-color-3 border-r border-color-5">
          <LabelText>{label}</LabelText>
          {labelSide}
        </div>
      )}
      <div className="p-1 bg-color-0" style={valueColumnStyle}>
        {children}
      </div>
    </div>
  </>
}
const LabelText = ({ children }: {
  children?: React.ReactNode
}) => {
  return children && (
    <span className="select-none text-color-7">
      {children}
    </span>
  )
}

const Indent = ({ className }: {
  className?: string
}) => {
  const { indentSizePx } = React.useContext(VFormContext)

  return (
    <div
      className={className}
      style={{ flexBasis: indentSizePx ?? 24 }}
    ></div>
  )
}

const VForm = {
  Container,
  Item,
}

type VFormContextValuePublic = {
  rightColumnWidth?: string
  indentSizePx?: number
}
type VFormContextValue = VFormContextValuePublic & {
  depth: number
}
const VFormContext = React.createContext<VFormContextValue>({
  depth: 0,
})
