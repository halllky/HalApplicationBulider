using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Linq;
using System.Reflection;

namespace HalApplicationBuilder.Core {
    public abstract class AggregateMemberBase {

        public Config Config { get; init; }
        internal PropertyInfo UnderlyingPropertyInfo { get; init; }

        public string Name { get; }
        public bool IsPrimaryKey => UnderlyingPropertyInfo.GetCustomAttribute<KeyAttribute>() != null;
        public abstract bool IsCollection { get; }


        #region リレーション
        public Aggregate Owner { get; init; }
        public abstract IEnumerable<Aggregate> GetChildAggregates();
        #endregion リレーション


        #region CodeGenerating
        private IReadOnlyList<AutoGenerateDbEntityProperty> _dbColumnModel;
        private IReadOnlyList<AutoGenerateMvcModelProperty> _searchConditionModel;
        private IReadOnlyList<AutoGenerateMvcModelProperty> _searchResultModel;
        private IReadOnlyList<AutoGenerateInstanceModelProperty> _instanceModel;

        internal IReadOnlyList<AutoGenerateDbEntityProperty> ToDbColumnModel() {
            if (_dbColumnModel == null) _dbColumnModel = CreateDbColumnModel().ToArray();
            return _dbColumnModel;
        }
        internal IReadOnlyList<AutoGenerateMvcModelProperty> ToSearchConditionModel() {
            if (_searchConditionModel == null) _searchConditionModel = CreateSearchConditionModel().ToArray();
            return _searchConditionModel;
        }
        internal IReadOnlyList<AutoGenerateMvcModelProperty> ToSearchResultModel() {
            if (_searchResultModel == null) _searchResultModel = CreateSearchResultModel().ToArray();
            return _searchResultModel;
        }
        internal IReadOnlyList<AutoGenerateInstanceModelProperty> ToInstanceModel() {
            if (_instanceModel == null) _instanceModel = CreateInstanceModel().ToArray();
            return _instanceModel;
        }

        protected abstract IEnumerable<AutoGenerateDbEntityProperty> CreateDbColumnModel();
        protected abstract IEnumerable<AutoGenerateMvcModelProperty> CreateSearchConditionModel();
        protected abstract IEnumerable<AutoGenerateMvcModelProperty> CreateSearchResultModel();
        protected abstract IEnumerable<AutoGenerateInstanceModelProperty> CreateInstanceModel();
        #endregion CodeGenerating


        #region Runtime

        #endregion Runtime
    }
}
