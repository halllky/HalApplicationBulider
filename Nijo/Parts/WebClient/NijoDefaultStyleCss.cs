using Nijo.Util.CodeGenerating;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Nijo.Parts.WebClient {
    /// <summary>
    /// nijo-default-style.css ファイル
    /// </summary>
    internal class NijoDefaultStyleCss {

        /// <summary>
        /// 既定のCSSファイルを編集します。
        /// </summary>
        internal static SourceFile Generate(EmbeddedResource.Collection embeddedResources) => new SourceFile {
            FileName = "nijo-default-style.css",
            RenderContent = ctx => {

                // テンプレートアプリケーションのCSS
                var resource = embeddedResources.Get("react", "src", "__autoGenerated", "nijo-default-style.css");
                using var reader = resource.GetStreamReader();

                var sourceCode = $$"""
                    {{reader.ReadToEnd()}}
                    {{VForm2.RenderContainerQuery()}}
                    """;

                // ボタン色が指定されている場合は変更
                var buttonColor = ctx.Config.ButtonColor?.Trim().ToLower();
                if (!string.IsNullOrWhiteSpace(buttonColor) && buttonColor != DEFAULT_BUTTON_COLOR) {
                    sourceCode = sourceCode.Replace(DEFAULT_BUTTON_COLOR, buttonColor);
                }

                return sourceCode;
            },
        };

        /// <summary>
        /// 既定のボタン色。nijo.xmlでボタン色が指定されている場合、cssファイル名のこの文字列に対する置換が行われる。
        /// </summary>
        internal const string DEFAULT_BUTTON_COLOR = "cyan";
    }
}
