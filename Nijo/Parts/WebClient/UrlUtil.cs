using Nijo.Core;
using Nijo.Util.CodeGenerating;
using Nijo.Util.DotnetEx;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Nijo.Parts.WebClient {
    /// <summary>
    /// UrlUtil.ts ファイル
    /// </summary>
    internal class UrlUtil : ISummarizedFile {

        private readonly List<string> _sourceCode = new();

        internal void Add(string sourceCode) {
            _sourceCode.Add(sourceCode);
        }

        void ISummarizedFile.OnEndGenerating(CodeRenderingContext context) {
            context.ReactProject.UtilDir(reactUtilDir => {
                reactUtilDir.Generate( new SourceFile {
                    FileName = "UrlUtil.ts",
                    RenderContent = ctx => {
                        return $$"""
                            import React from 'react'
                            import { useNavigate } from 'react-router-dom'
                            import { ItemKey } from './LocalRepository'
                            import * as Types from '../autogenerated-types'

                            {{_sourceCode.SelectTextTemplate(source => $$"""
                            {{source}}

                            """)}}
                            """;
                    },
                });
            });
        }
    }
}
