chcp 65001 
@rem ↑ dotnetのビルド前イベントなのでutf8でないと動かない 
 
@echo off 
setlocal 
 
@rem Nijoのビルド高速化のため、GUIプロジェクトのビルド後ファイルがある場合はスキップ 
if exist "%~dp0..\Xml設定GUI\dist\index.html" goto END_SUCCESS 
 
@rem GUIプロジェクトのUI部品など(__autoGeneratedフォルダ)を最新化 
set "TEMPLATE_AUTO_GEN_DIR=%~dp0..\Nijo.ApplicationTemplate\react\src\__autoGenerated" 
set "GUI_PROJ_AUTO_GEN_DIR=%~dp0..\Xml設定GUI\src\__autoGenerated" 
robocopy "%TEMPLATE_AUTO_GEN_DIR%" "%GUI_PROJ_AUTO_GEN_DIR%" /E /PURGE /R:0 /W:0 
 
if not %errorlevel% lss 8 goto END_ERROR 
 
@rem GUIプロジェクトをビルド 
pushd %~dp0..\Xml設定GUI 
 
call npm ci 
if not "%ERRORLEVEL%" == "0" ( 
    popd 
    goto END_ERROR 
) 
 
call npm run build 
if not "%ERRORLEVEL%" == "0" ( 
    popd 
    goto END_ERROR 
) 
 
goto END_SUCCESS 
 
@rem このバッチでエラーがあってもGUI設定コマンドが使えなくなるだけなので、Nijoプロジェクト自体のビルドだけは成功するようにする（終了コード"0":成功 を返す）。 
:END_ERROR 
echo. 
echo GUIプロジェクトのビルドに失敗しました。 
echo. 
mkdir %~dp0..\Xml設定GUI\dist 
echo GUI Tool is not availabe.>%~dp0..\Xml設定GUI\dist\index.html 
exit /b 0 
 
@rem 正常終了 
:END_SUCCESS 
exit /b 0 
