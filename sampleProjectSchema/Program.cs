using System;
using System.Collections.Generic;
using System.Linq;
using System.IO;

namespace haldoc {
    class Program {
        static void Main(string[] args) {
            Console.WriteLine("コード自動生成 開始");

            var context = new Core.ProjectContext(
                "サンプルプロジェクト",
                System.Reflection.Assembly.GetExecutingAssembly());

            File.WriteAllText(
                @"../../../../haldoc/EF/__AutoGenerated.cs",
                new CodeGenerating.EFCodeGenerator() { Context = context }.TransformText());
            File.WriteAllText(
                @"../../../../haldoc/Models/__AutoGenerated.cs",
                new CodeGenerating.MvcModelGenerator() { Context = context }.TransformText());

            foreach (var aggregate in context.EnumerateRootAggregates()) {
                File.WriteAllText(
                    $@"../../../../haldoc/Views/__AutoGenerated/{aggregate.Name}__ListView.cshtml",
                    new CodeGenerating.ListViewGenerator() { Context = context, Aggregate = aggregate }.TransformText());

                File.WriteAllText(
                    $@"../../../../haldoc/Views/__AutoGenerated/{aggregate.Name}__CreateView.cshtml",
                    new CodeGenerating.CreateViewGenerator() { Context = context, Aggregate = aggregate }.TransformText());

                File.WriteAllText(
                    $@"../../../../haldoc/Controllers/__AutoGenerated/{aggregate.Name}Controller.cs",
                    new CodeGenerating.MvcControllerGenerator() { Context = context, Aggregate = aggregate }.TransformText());
            }

            Console.WriteLine("コード自動生成 終了");
        }
    }
}
